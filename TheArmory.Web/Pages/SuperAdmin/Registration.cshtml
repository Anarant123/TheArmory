@page
@model TheArmory.Web.Pages.SuperAdmin.Registration

@{
    ViewData["Title"] = "Регистрация";
}

<style>
    .square-container {
        position: relative;
        width: 100%;
        padding-top: 100%; /* Высота контейнера равна его ширине, создавая квадрат */
        overflow: hidden;
    }

    .square-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; /* Сохраняет пропорции и обрезает изображение */
    }

</style>

@await Html.PartialAsync("ErrorModelWindow", Model.RequestResult)

<div class="container mt-5 text-center">
    <h1>Регистрация</h1>
    <form method="post" enctype="multipart/form-data" class="mt-4 d-inline-block">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <input type="file" id="file-input" asp-for="Command.Photo" accept="image/*" style="display: none;">
                <div class="row mt-3">
                    <div class="square-container">
                        <img id="profile-photo" src="/Default/Images/Person/DefoultPersonImage.png" alt="Фото профиля" class="img-fluid rounded-circle square-image">
                    </div>
                </div>
                <div class="row mt-3">
                    <button type="button" class="btn btn-primary btn-block" onclick="document.getElementById('file-input').click();">Добавить фото</button>
                </div>
                <div class="row mt-3">
                    <input type="text" asp-for="Command.Login" class="form-control" placeholder="Логин" required>
                    <span asp-validation-for="Command.Login" class="text-danger"></span>
                </div>
                <div class="row mt-3">
                    <input type="text" asp-for="Command.Name" class="form-control" placeholder="Имя" required>
                    <span asp-validation-for="Command.Name" class="text-danger"></span>
                </div>
                <div class="row mt-3">
                    <input type="password" asp-for="Command.Password" class="form-control" placeholder="Пароль" required>
                    <span asp-validation-for="Command.Password" class="text-danger"></span>
                </div>
                <div class="row mt-3">
                    <input type="password" asp-for="Command.PasswordConfirm" class="form-control" placeholder="Повторите пароль" required>
                    <span asp-validation-for="Command.PasswordConfirm" class="text-danger"></span>
                </div>

                <div class="row mt-3">
                    <button type="submit" class="btn btn-primary btn-block">Зарегистрировать</button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    document.getElementById('file-input').addEventListener('change', function() {
        let files = event.target.files;

        if (files.length > 0) {
            let reader = new FileReader();
            reader.onload = function (e) {
                let arrayBuffer = e.target.result;

                let image = document.getElementById("profile-photo");
                let blob = new Blob([new Uint8Array(arrayBuffer)], { type: 'image/jpeg' });
                image.src = URL.createObjectURL(blob);
            };
            reader.readAsArrayBuffer(files[0]); // Читаем только первый файл
        }
    });
</script>
